{% extends "base.html" %}
{% load qr %}
{% block title %}Index{% endblock %}


{% block lateral_izquierda %}
<div class="panel panel-primary">
  <div class="panel-heading">
    <h3 class="panel-title">Acciones</h3>
  </div>
</div>
<a href="/nuevoCatalogo"> <button id='nuevoCatalogo'>Nuevo Catalogo</button></a>
<button id="updateCatalogo">Actualizar</button>

{% endblock %}


        {% block body_block %}



    <div class="panel panel-primary">
      <div class="panel-heading">
        <h3 class="panel-title">{{catalogo.nombre_catalogo}}</h3>
      </div>
    </div>
    <ul class="list-group" id="catalogo" data-catalogo = "{{ catalogo_id }}">
       <li class="list-group-item">
    {% if catalogo %}
          Fecha: {{catalogo.fecha_alta_catalogo}} </h3>
            <p>
              Descripcion: {{ catalogo.descripcion_catalogo }}
            </p>
            Tag: {{catalogo.tag_catalogo}}
            Tipo: {{catalogo.tipo_catalogo}}
            <br>
            <br>
            Creado por: {{ catalogo.usuario }}
            Para la Organizacion: {{catalogo.organizacion}}
            <br>
            {{ catalogo.qr_data|qrcode:"my alt" }}
            <br>

    {% else %}
         <strong>No hay Catalogo</strong>
    {% endif %}
  </li>
  </ul>


      <div class="col-xs-12 col-sm-12 placeholder">
         <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title">Items del catalogo </h3>
          </div>
        </div>
        <table class="table table-hover">
        <thead>
          <tr>
            <th>Item</th>
            <th>Fecha</th>
            <th>Tag1</th>
            <th>TAG2</th>
            <th>TAG3</th>
            <th>Cantidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if lista_items %}
            {% for i in lista_items %}
              <tr>
                <td>{{i.nombre_item}}</td>
                <td>{{ i.fecha_alta_item }}</td>
                <td>{{ i.tag1 }}</td>
                <td>{{ i.tag2 }}</td>
                <td>{{ i.tag3 }}</td>
                <td>{{ i.cantidad }}</td>
                <td><button class="borrarBoton" data-item="{{ i|documento_id}}" id="{{ i|documento_id}}">Borrar</button></td>
              </tr>
            {% endfor %}
            {% else %}
                 <strong>No hay Objetos.</strong>
            {% endif %}
          </tr>
        </tbody>
        </table>
      </div>






  <script>

  $(function () {
      $("#updateCatalogo").click(function (){

          $.ajax({
            url: "/updateCatalogo/",
            type: "get", //send it through get method
            data:{catalogo_id:$("#catalogo").attr("data-catalogo")},
            cache: false,
            success: function(response) {
                $('.table').html(response)

            },
            error: function(xhr) {
            }
        });
      })
  })


  $(document).on('click', ".borrarBoton", function () {
    console.log("boton para borrar")
    var catid = $(this).attr("data-item")
    var catalogo=$("#catalogo").attr("data-catalogo")
    console.log("has pulsado el catalogo")
    console.log(catalogo)

    $.ajax({
      url: "/borrarItemFromCatalogo/",
      type: "get", //send it through get method
      data:{item_id:catid,catalogo_id:catalogo},
      success: function(response) {
        $('.table').html(response)

      },
      error: function(xhr) {
      }
    });
  });












    $(document).on('click', ".addBoton", function () {
      console.log("boton para a√±adir")
      var item_id = $(this).attr("data-item")
      var catalogo_id = $("#catalogo").attr("data-catalogo")
      console.log("has pulsado el boton")
      console.log(item_id)
      console.log("Del catalogo")
      console.log(catalogo_id)
      $.ajax({
        url: "/addToCatalogo/",
        type: "get", //send it through get method
        data:{item_id:item_id,catalogo_id:catalogo_id},
        success: function(response) {
          console.log(response);
          $('#lista_items').html(function(){
              var content = '<ul class="list-group" id="lista_items">  <li class="list-group-item"> ';
              for(var i = 0; i < response["nombre_items"].length; i++){
                content = content + '<br><h>' + response["nombre_items"][i]+'</h><br>';
              }
                content = content + '</li></ul>';
                return content;
          }
        )},
        error: function(xhr) {
    //Do Something to handle error
        }
    });

    });
  </script>




        {% endblock %}
